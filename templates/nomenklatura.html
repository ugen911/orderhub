{% extends "base.html" %}
{% block content %}
<style>
    .state-button {
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        font-weight: bold;
        color: white;
        margin-right: 8px;
        margin-bottom: 8px;
    }

    .state-true {
        background-color: #dc3545;
    }

    .state-false {
        background-color: #6c757d;
    }

    .highlight-price {
        font-size: 1.2rem;
        font-weight: bold;
        color: #2c3e50;
    }

    .minibox {
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 12px;
    }

    .section-title {
        margin-top: 2rem;
        margin-bottom: 1rem;
        font-weight: bold;
    }

    .analog-card {
        min-height: 150px;
    }
</style>

<div class="container-fluid p-3 p-md-4">

    <!-- üî¥ –õ–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–ª–∞–≥–∏ -->
    <div class="mb-3 d-flex flex-wrap">
        <div class="state-button {{ 'state-true' if data.ne_ispolzuetsya_v_zakaze else 'state-false' }}">
            –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –í –ó–ê–ö–ê–ó–ï
        </div>
        <div class="state-button {{ 'state-true' if data.nelikvid else 'state-false' }}">
            –ù–ï–õ–ò–ö–í–ò–î
        </div>
        <div class="state-button {{ 'state-true' if data.list_ozhidaniya else 'state-false' }}">
            –û–ñ–ò–î–ê–ù–ò–ï
        </div>
        <div class="state-button {{ 'state-true' if data.zafiksirovat_minimalki else 'state-false' }}">
            –ó–ê–§–ò–ö–°–ò–†–û–í–ê–¢–¨
        </div>
        <div class="state-button {{ 'state-true' if data.pometkaudalenija else 'state-false' }}">
            –£–î–ê–õ–ï–ù
        </div>
    </div>

    <!-- üìå –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ -->
    <div class="row mb-4">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="col-12 col-md-4">
            <div class="minibox">
                <h5><strong>–ö–æ–¥:</strong> {{ data.kod }}</h5>
                <p><strong>–ê—Ä—Ç–∏–∫—É–ª:</strong> {{ data.artikul }}</p>
                <p><strong>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å:</strong> {{ data.proizvoditel }}</p>
                <p><strong>–¢–∏–ø –¥–µ—Ç–∞–ª–∏:</strong> {{ data.type_detail }}</p>
                <p><strong>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ:</strong><br>{{ data.naimenovanie }}</p>
            </div>
        </div>

        <!-- –¶–µ–Ω—ã –∏ –æ—Å—Ç–∞—Ç–∫–∏ -->
        <div class="col-12 col-md-4">
            <div class="minibox">
                <p class="highlight-price">–†–æ–∑–Ω–∏—á–Ω–∞—è: {{ data.tsenarozn }}‚ÇΩ</p>
                <p>–ó–∞–∫—É–ø: {{ data.tsenazakup }}‚ÇΩ</p>
                <p>–°—Ä–µ–¥–Ω—è—è: {{ data.middleprice }}‚ÇΩ</p>
                <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è: {{ data.maxprice }}‚ÇΩ</p>
            </div>
            <div class="minibox">
                <p>–û—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥: {{ data.osnsklad }} {{ data.edizm }}</p>
                <p>–°–∫–ª–∞–¥ –∑–∞–∫–∞–∑–æ–≤: {{ data.zakazy_sklad }}</p>
                <p>–°—Ç–µ–ª–ª–∞–∂: {{ data.stellazh }}</p>
            </div>
        </div>

        <!-- –ü–æ—Å—Ç–∞–≤—â–∏–∫ + –ú–∏–Ω–∏–º—É–º + –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
        <div class="col-12 col-md-4">
            <div class="minibox">
                <p><strong>–°–∫–ª–∞–¥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞:</strong> {{ data.delivery_sklad }}</p>
                <p>–û—Å—Ç–∞—Ç–æ–∫: {{ data.delivery_stock }}</p>
                <p>–¶–µ–Ω–∞: {{ data.delivery_price }}‚ÇΩ</p>
            </div>
            <div class="minibox">
                <p><strong>–ú–∏–Ω–∏–º–∞–ª:</strong> {{ data.minimal }}</p>
                <p>–ú–∏–Ω–∏–º–∞–ª (—Ä–∞—Å—á–µ—Ç): {{ data.minimal_raschet }}</p>
            </div>
            <div class="minibox">
                <p><strong>ABC:</strong> {{ data.abc }}</p>
                <p><strong>XYZ:</strong> {{ data.xyz }}</p>
                <p>–ü—Ä–æ–¥–∞–Ω–æ –∑–∞ –≥–æ–¥: {{ data.total_sales_last_12_months }}</p>
                <p>–ü—Ä–æ–¥–∞–Ω–æ –∑–∞ 3 –º–µ—Å: {{ data.total_sales_last_3_months }}</p>
            </div>
        </div>
    </div>

    <!-- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 36 –º–µ—Å—è—Ü–µ–≤ -->
    <h5 class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</h5>
    <div class="table-responsive">
        <table class="table table-sm table-bordered text-center align-middle">
            <thead class="table-light">
                <tr>
                    <th>–ú–µ—Å—è—Ü</th>
                    {% for month in data.monthly_stats.keys() %}
                    <th>{{ month }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>–ü—Ä–æ–¥–∞–∂–∏</strong></td>
                    {% for s in data.monthly_stats.values() %}
                    <td>{{ s.sales }}</td>
                    {% endfor %}
                </tr>
                <tr>
                    <td><strong>–°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂</strong></td>
                    {% for s in data.monthly_stats.values() %}
                    <td>{{ s.salesum }}</td>
                    {% endfor %}
                </tr>
                <tr>
                    <td><strong>–û—Å—Ç–∞—Ç–æ–∫</strong></td>
                    {% for s in data.monthly_stats.values() %}
                    <td>{{ s.stock }}</td>
                    {% endfor %}
                </tr>
                <tr>
                    <td><strong>–¶–µ–Ω–∞</strong></td>
                    {% for s in data.monthly_stats.values() %}
                    <td>{{ s.tsena }}</td>
                    {% endfor %}
                </tr>
                <tr>
                    <td><strong>–ü–æ—Å—Ç–∞–≤–∫–∏</strong></td>
                    {% for s in data.monthly_stats.values() %}
                    <td>{{ s.sup }}</td>
                    {% endfor %}
                </tr>
                <tr>
                    <td><strong>–°—É–º–º–∞ –ø–æ—Å—Ç–∞–≤–æ–∫</strong></td>
                    {% for s in data.monthly_stats.values() %}
                    <td>{{ s.supsum }}</td>
                    {% endfor %}
                </tr>
            </tbody>
        </table>
    </div>

    <!-- üîÅ –ê–Ω–∞–ª–æ–≥–∏ -->
    <h5 class="section-title">–ê–Ω–∞–ª–æ–≥–∏</h5>
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
        {% for analog in data.analogs | sort(attribute='osnsklad', reverse=True) %}
        <div class="col">
            <div class="card analog-card h-100">
                <div class="card-body">
                    <h6>{{ analog.naimenovanie }}</h6>
                    <p>
                        –ö–æ–¥: {{ analog.kod }}<br>
                        –ê—Ä—Ç–∏–∫—É–ª: {{ analog.artikul }}<br>
                        –û—Å—Ç–∞—Ç–æ–∫: {{ analog.osnsklad }}<br>
                        –ü—Ä–æ–¥–∞–∂–∏ –∑–∞ –≥–æ–¥: {{ analog.total_sales_last_12_months }}<br>
                        –†–æ–∑–Ω–∏—Ü–∞: {{ analog.tsenarozn }}
                    </p>
                    <a href="/nomenklatura/{{ analog.kod }}/view" class="btn btn-sm btn-outline-primary">–ü–µ—Ä–µ–π—Ç–∏</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- üìã –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ -->
    <h5 class="section-title">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h5>
    <div class="table-responsive">
        <table class="table table-striped table-sm">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ê—Ä—Ç–∏–∫—É–ª</th>
                    <th>–ï–¥.</th>
                    <th>–ó–∞–∫—É–ø</th>
                    <th>–ö–æ–ª-–≤–æ</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–†–æ–∑–Ω–∏—Ü–∞</th>
                    <th>–ù–∞—Ü–µ–Ω–∫–∞</th>
                    <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
                    <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                    <th>–°–∫–ª–∞–¥</th>
                    <th>–û–ø–ª–∞—Ç–∞</th>
                    <th>–°—á–µ—Ç ‚Ññ</th>
                    <th>–î–∞—Ç–∞ —Å—á–µ—Ç–∞</th>
                </tr>
            </thead>
            <tbody>
                {% for order in data.orders %}
                <tr>
                    <td>{{ order.data_prinatia_zakaza }}</td>
                    <td>{{ order.artikul }}</td>
                    <td>{{ order.edinicy_izmerenia }}</td>
                    <td>{{ order.zakup }}</td>
                    <td>{{ order.kolicestvo }}</td>
                    <td>{{ order.summa }}</td>
                    <td>{{ order.status }}</td>
                    <td>{{ order.roznica }}</td>
                    <td>{{ order.nacenka }}</td>
                    <td>{{ order.primecanie }}</td>
                    <td>{{ order.postavsik }}</td>
                    <td>{{ order.sklad }}</td>
                    <td>{{ order.oplata }}</td>
                    <td>{{ order.schet_no }}</td>
                    <td>{{ order.data_sceta }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>
{% endblock %}